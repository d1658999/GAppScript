# MEGA 資料分析器使用說明

## 概述

這個 Google Apps Script 專案會自動從指定的 Google Sheets 分頁中擷取特定的圖表，並將這些圖表以保持原始比例的方式插入到 Google Slides 簡報中。系統支援多張投影片，每張投影片最多放置三個圖表。

## 目標圖表

系統會自動識別並處理以下三個特定圖表：
1. `MaxPwr - TX Power`
2. `MaxPwr - ACLR - Max(E_-1,E_+1)`
3. `MaxPwr - EVM`

## 主要特色

### 🎯 **智慧圖表篩選**
- 自動識別目標圖表
- 支援標題匹配、內容分析、位置推測

### 📐 **原始比例保持**
- 保持圖表的原始寬高比，避免變形
- 智慧計算最適尺寸和位置

### 📄 **多投影片支援**
- 每張投影片最多放置 3 個圖表
- 自動建立多張投影片容納所有圖表
- 投影片標題包含頁碼資訊

### 🎨 **優化排版設計**
- 根據圖表數量自動選擇最佳排版
- 1 張圖表：居中顯示
- 2 張圖表：垂直排列
- 3 張圖表：緊湊垂直排列

## 檔案結構

- `analyze_mega_data.gs` - 主要功能實作
- `demo.gs` - 示範和測試函式
- `appsscript.json` - 專案設定檔
- `README.md` - 使用說明文件

## 使用步驟

### 1. 設定權限

確保您的 Google Apps Script 專案有以下權限：
- Google Sheets API
- Google Slides API  
- Google Drive API

### 2. 執行分析

在 Google Apps Script 編輯器中：

1. 開啟 `demo.gs` 檔案
2. 執行 `runMegaDataAnalysis()` 函式
3. 首次執行時會要求授權，請同意所有權限要求

### 3. 測試功能

可以使用以下測試函式：

- `quickTest()` - 快速測試連線
- `testChartFiltering()` - 測試圖表識別功能（不建立投影片）
- `testMultiSlideFeature()` - 測試多投影片功能
- `demoProportionalLayout()` - 演示比例保持功能
- `testScreenshotStyleLayout()` - 測試截圖樣式排版效果
- `demoScreenshotTitleStyle()` - 演示截圖樣式標題格式

## 主要功能

### `analyzeMegaData()`
- 從 Google Sheets 的 `[NR_TX_LMH]Summary&NR_Test_1` 分頁取得所有圖表
- 智慧識別三個目標圖表
- 將圖表轉換為圖片格式
- 在 Google Slides 中建立適當數量的新投影片
- 以保持原始比例的方式插入圖片，每張投影片最多 3 個圖表

### `createSlidesWithCharts()`
- 支援多張投影片建立
- 自動計算所需投影片數量
- 為每張投影片添加頁碼標題

### `calculateProportionalLayout()`
- 根據圖表數量計算最佳排版
- 保持圖表原始比例
- 支援 1-3 張圖表的不同排版模式

### `filterTargetCharts()`
- 通過多種方法識別目標圖表：
  - 圖表標題匹配
  - 資料範圍內容分析
  - 位置推測
- 自動排序圖表順序

### `testConnections()`
- 測試與 Google Sheets 和 Google Slides 的連線
- 檢查目標分頁是否存在
- 統計並顯示找到的目標圖表

## 設計特色

### 🎨 **截圖樣式實現**
根據提供的實際截圖進行精確優化：

**主標題樣式**
- 字體：Arial 18px 粗體
- 顏色：#1c4587 (藍色)
- 位置：頂部居中，距頂部 8px
- 格式：包含頁碼 "(1/2)"

**圖表標題樣式**
- 字體：Arial 11px 粗體  
- 顏色：#000000 (黑色)
- 位置：圖表內部左上角
- 對齊：靠左對齊

**圖表比例**
- 寬高比：5:3 (符合 Google Sheets 圖表)
- 排列：垂直緊湊排列
- 間距：8px (如截圖所示)
- 邊距：15px

### 📊 **圖表識別精確度**
- 智慧識別三個指定圖表
- 標題自動映射到正確格式
- 確保與截圖中的圖表標題一致

### 🎨 **多種排版模式（基於實際截圖優化）**
- **單張圖表**: 居中顯示，使用 5:1 寬高比，固定高度 1.4 英寸
- **兩張圖表**: 垂直排列，平分空間，固定高度 1.4 英寸
- **三張圖表**: 緊湊垂直排列，間距 8px，固定高度 1.4 英寸

### 📐 **原始比例保持（5:1 寬高比，固定高度）**
- 圖表高度固定為 1.4 英寸，提供更緊湊的佈局
- 保持 5:1 寬高比，避免圖表變形
- 智慧居中對齊
- 最大化利用可用空間

### 📄 **多投影片支援**
- 每張投影片最多 3 個圖表
- 自動分頁處理更多圖表
- 投影片標題包含頁碼 (例: "標題 (1/2)")

### 🎯 **自動佈局（基於截圖調整）**
- 投影片尺寸：720 x 540
- 標題區域：35px 高度，距頂部 8px
- 圖表間距：8px（緊湊排列）
- 邊距：15px

## 設定項目

在 `analyze_mega_data.gs` 檔案頂部的常數區域：

```javascript
const SPREADSHEET_ID = '1nnzLzALFvtwW0Lz8aVGCw7O0iaPXwN3_wRUF3BC2iak';
const PRESENTATION_ID = '1_zV6grTwFms2a0jE2i9Tz0X6mjbnCpZk8VDKIyBLxi8';
const TARGET_SHEET_NAME = '[NR_TX_LMH]Summary&NR_Test_1';
const SLIDE_TITLE = 'MEGA 資料分析 - NR TX LMH 測試結果';

const TARGET_CHART_TITLES = [
  'MaxPwr - TX Power',
  'MaxPwr - ACLR - Max(E_-1,E_+1)', 
  'MaxPwr - EVM'
];

const MAX_CHARTS_PER_SLIDE = 3; // 每個投影片最多放三張圖片
```

## 智慧圖表識別

系統使用多層次的圖表識別方法：

1. **標題匹配** - 直接比對圖表標題
2. **內容分析** - 分析圖表的資料範圍內容
3. **位置推測** - 根據圖表在分頁中的位置推測
4. **標題精確化** - 自動改善圖表標題的準確性

## 注意事項

1. **權限要求**: 確保您對指定的 Google Sheets 和 Google Slides 有編輯權限
2. **圖表格式**: 只能處理 Google Sheets 內建的圖表，不支援插入的圖片
3. **原始比例**: 圖表會保持原始比例，避免任何變形或拉伸
4. **投影片限制**: 每張投影片最多放置 3 個圖表，超過會自動建立新投影片
5. **圖表識別**: 系統會智慧識別目標圖表，即使標題不完全匹配也能正確處理
6. **錯誤處理**: 所有錯誤都會記錄在日誌中，請檢查執行日誌以診斷問題

## 疑難排解

### 常見錯誤

1. **權限不足**: 確認已授權所有必要的 API 權限
2. **找不到分頁**: 檢查 `TARGET_SHEET_NAME` 是否正確
3. **沒有找到目標圖表**: 使用 `testChartFiltering()` 檢查圖表識別
4. **圖片插入失敗**: 可能是圖表格式不相容，檢查日誌獲取詳細錯誤

### 除錯技巧

1. 使用 `Logger.log()` 查看執行過程
2. 先執行 `testConnections()` 確認基本設定
3. 使用 `testChartFiltering()` 測試圖表識別功能
4. 檢查 Google Apps Script 的執行日誌
5. 確認 Google Sheets 和 Slides 的分享設定

## 開發指南

### 程式碼規範

- 遵循 Google Apps Script 最佳實踐
- 使用 V8 Runtime
- 所有函式都有 JSDoc 註解
- 錯誤處理使用 try/catch 結構
- 中文註解和日誌

### 擴展功能

如需新增功能，請：

1. 在對應的 `.gs` 檔案中新增函式
2. 添加適當的 JSDoc 註解，包含權限要求
3. 更新 `appsscript.json` 中的權限範圍（如需要）
4. 在此文件中更新使用說明

## 版本資訊

- 版本: 3.1.0
- 建立日期: 2025-08-12
- 更新日期: 2025-08-12
- 作者: GitHub Copilot
- 相容性: Google Apps Script V8 Runtime

## 更新歷史

### v3.1.3 (2025-08-12)
- 📏 **固定圖表高度** - 將所有圖表高度固定為 1.4 英寸，實現更緊湊的投影片佈局
- 🎯 **優化排版** - 改善垂直排列的間距配置，提升視覺效果
- 🧪 **測試更新** - 更新測試函式以驗證固定高度功能

### v3.1.2 (2025-08-12)
- 🎨 **移除圖表標題** - 根據需求移除投影片中每個圖表的標題顯示
- 🧹 **程式碼清理** - 停用 `addChartLabelOptimized` 函式，簡化投影片佈局

### v3.1.1 (2025-08-12)
- 🎯 **比例修正** - 根據需求規格將圖表比例調整為 5:1
- 📝 **註解更新** - 更正程式碼註解，確保與實際設定一致
- 🧪 **測試增強** - 新增完整測試套件和乾運行功能
- 📖 **文件改善** - 新增快速執行指南和測試執行器

### v3.1.0 (2025-08-12)
- 🖼️ **截圖樣式實現** - 根據實際截圖精確調整排版
- 📐 **5:3 寬高比優化** - 符合 Google Sheets 圖表的典型比例
- 🎨 **精確標題樣式** - 主標題藍色居中，圖表標題黑色左對齊
- 📏 **緊湊間距設計** - 間距 8px，邊距 15px，如截圖所示
- 🎯 **標題位置優化** - 圖表標題位於圖表內部左上角

### v3.0.0 (2025-08-12)
- 🚀 **多投影片支援** - 每張投影片最多 3 個圖表
- 📐 **原始比例保持** - 避免圖表變形和拉伸
- 🎨 **優化排版設計** - 根據圖表數量自動選擇最佳排版
- 🏷️ **改善標題系統** - 支援多頁投影片標題和頁碼
- 🧪 **新增測試功能** - 多投影片和比例保持測試

### v2.0.0 (2025-08-12)
- 🎯 新增特定圖表篩選功能
- 📐 改為垂直排列佈局
- 🧠 智慧圖表識別系統
- 🏷️ 自動圖表標籤功能
- 🧪 增強的測試功能

### v1.0.0 (2025-08-12)
- 🚀 初始版本發布
